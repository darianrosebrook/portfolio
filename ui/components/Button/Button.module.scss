@use './Button.tokens.generated.scss' as buttonTokens;

.button {
  @include buttonTokens.vars;

  // Selective reset - only reset what we need to control
  display: inline-flex;
  gap: var(--button-size-gap-default);
  justify-content: center;
  align-items: center;

  // Box Model
  width: fit-content;
  min-width: var(--button-size-min-medium);
  min-height: var(--button-size-min-medium);
  margin: 0;
  padding: var(--button-size-padding-small) var(--button-size-padding-small);

  // Visual
  background: none;
  background-color: var(--button-color-background-default);
  border: none;
  border-radius: var(--button-size-radius);
  color: var(--button-color-foreground-default);

  // Typography
  font: inherit;
  font-weight: var(--button-text-weight, 500);
  font-size: var(--button-text-size-medium);
  line-height: normal;
  text-decoration: none;
  white-space: nowrap;
  transition:
    transform var(--button-motion-duration-fast)
      var(--button-motion-easing-standard),
    background-color var(--button-motion-duration-fast)
      var(--button-motion-easing-standard),
    border-color var(--button-motion-duration-fast)
      var(--button-motion-easing-standard),
    color var(--button-motion-duration-fast)
      var(--button-motion-easing-standard);

  // Interaction
  cursor: pointer;

  // CSS Containment for performance optimization
  contain: layout style paint;

  &:active {
    transform: scale(var(--button-motion-scale-pressed));
  }

  &.isLoading {
    pointer-events: none;
  }

  .spinner {
    display: none;
    width: var(--button-size-spinner-width);
    height: var(--button-size-spinner-height);
    border: var(--button-size-spinner-borderWidth) solid
      var(--button-color-spinner-border);
    border-top-color: var(--button-color-spinner-borderAccent);
    border-radius: var(--button-size-spinner-borderRadius);
    animation: button-spinner-rotate var(--button-motion-duration-spinner)
      linear infinite;
  }

  .loadingText {
    opacity: 0.8;
  }

  &:disabled {
    background-color: var(--button-color-background-disabled);
    color: var(--button-color-foreground-disabled);
    cursor: not-allowed;
  }

  &:hover {
    background-color: var(--button-color-background-hover);
    text-decoration: none;
  }

  &:focus {
    border-radius: var(--button-size-radius);
    outline: none;
  }

  &:matches(:focus-visible, :focus) {
    outline: var(--button-focus-outlineWidth) solid
      var(--button-focus-outlineColor);
    outline-offset: var(--button-focus-outlineOffset);
  }

  // Remove adjacent sibling selector - let parent containers handle spacing
  // Use gap, flexbox, or CSS Grid in parent components instead

  &.small {
    gap: var(--button-size-gap-small, 0.5rem);
    min-width: var(--button-size-min-small);
    min-height: var(--button-size-min-small);
    padding: var(--button-size-padding-small, var(--button-size-gap-small));
    font-size: var(--button-text-size-small);
  }

  &.medium {
    gap: var(--button-size-gap-default);
    min-width: var(--button-size-min-medium);
    min-height: var(--button-size-min-medium);
    padding: var(--button-size-padding-small) var(--button-size-padding-large);
    font-size: var(--button-text-size-medium);
  }

  &.large {
    gap: var(--button-size-gap-large, 0.75rem);
    min-width: var(--button-size-min-large);
    min-height: var(--button-size-min-large);
    padding: var(--button-size-padding-large, var(--button-size-gap-large));
    font-size: var(--button-text-size-large);
  }

  &.primary {
    background-color: var(--button-color-background-primary);
    border: var(--button-size-border) solid var(--button-color-border-primary);
    color: var(--button-color-foreground-primary);

    &:hover {
      // Use color-mix() for dynamic hover effect (lighter background)
      background-color: color-mix(
        in srgb,
        var(--button-color-background-primary) 85%,
        white
      );
      border-color: color-mix(
        in srgb,
        var(--button-color-border-primary) 85%,
        white
      );
      color: var(--button-color-foreground-primaryHover);
    }

    &:active {
      // Use color-mix() for dynamic active effect (darker background)
      background-color: color-mix(
        in srgb,
        var(--button-color-background-primary) 85%,
        black
      );
      border-color: color-mix(
        in srgb,
        var(--button-color-border-primary) 85%,
        black
      );
      color: var(--button-color-foreground-primaryActive);
    }
  }

  &.secondary {
    background-color: var(--button-color-background-secondary);
    border: var(--button-size-border) solid var(--button-color-border-secondary);
    color: var(--button-color-foreground-secondary);

    &:hover {
      background-color: var(--button-color-background-secondaryHover);
      border-color: var(--button-color-border-secondaryHover);
      color: var(--button-color-foreground-secondaryHover);
    }

    &:active {
      background-color: var(--button-color-background-secondaryActive);
      border-color: var(--button-color-border-secondaryActive);
      color: var(--button-color-foreground-secondaryActive);
    }
  }

  &.tertiary {
    background-color: var(--button-color-background-tertiary);
    border: var(--button-size-border) solid var(--button-color-border-tertiary);
    color: var(--button-color-foreground-tertiary);

    &:hover {
      background-color: var(--button-color-background-tertiaryHover);
      border-color: var(--button-color-border-tertiaryHover);
      color: var(--button-color-foreground-tertiaryHover);
    }

    &:active {
      background-color: var(--button-color-background-tertiaryActive);
      border-color: var(--button-color-border-tertiaryActive);
      color: var(--button-color-foreground-tertiaryActive);
    }
  }

  &.ghost {
    background-color: transparent;
    border: var(--button-size-border) solid transparent;
    color: var(--button-color-foreground-primary);

    &:hover {
      background-color: var(--button-color-background-hover);
      color: var(--button-color-foreground-hover);
    }

    &:active {
      background-color: var(--button-color-background-active);
      color: var(--button-color-foreground-active);
    }
  }

  &.destructive {
    background-color: var(--semantic-color-feedback-error-background);
    border: var(--button-size-border) solid
      var(--semantic-color-feedback-error-border);
    color: var(--semantic-color-feedback-error-foreground);

    &:hover {
      background-color: var(--semantic-color-feedback-error-background-hover);
      border-color: var(--semantic-color-feedback-error-border-hover);
    }

    &:active {
      background-color: var(--semantic-color-feedback-error-background-active);
      border-color: var(--semantic-color-feedback-error-border-active);
    }
  }

  &.outline {
    background-color: transparent;
    border: var(--button-size-border) solid var(--button-color-border-secondary);
    color: var(--button-color-foreground-secondary);

    &:hover {
      background-color: var(--button-color-background-hover);
      border-color: var(--button-color-border-hover);
      color: var(--button-color-foreground-hover);
    }

    &:active {
      background-color: var(--button-color-background-active);
      border-color: var(--button-color-border-active);
      color: var(--button-color-foreground-active);
    }
  }
}

// Container queries for responsive button sizing
@supports (container-type: inline-size) {
  .button {
    @container (max-width: 12rem) {
      // Compact button for small containers
      gap: calc(var(--button-size-gap-default) * 0.75);
      min-width: calc(var(--button-size-min-medium) * 0.9);
      min-height: calc(var(--button-size-min-medium) * 0.9);
      padding: calc(var(--button-size-padding-small) * 0.75);
      font-size: calc(var(--button-text-size-medium) * 0.9);

      &.small {
        min-width: calc(var(--button-size-min-small) * 0.9);
        min-height: calc(var(--button-size-min-small) * 0.9);
        padding: calc(
          var(--button-size-padding-small, var(--button-size-gap-small)) * 0.75
        );
        font-size: calc(var(--button-text-size-small) * 0.9);
      }

      &.large {
        min-width: calc(var(--button-size-min-large) * 0.9);
        min-height: calc(var(--button-size-min-large) * 0.9);
        padding: calc(
          var(--button-size-padding-large, var(--button-size-gap-large)) * 0.75
        );
        font-size: calc(var(--button-text-size-large) * 0.9);
      }
    }

    @container (max-width: 8rem) {
      // Minimal button for very small containers
      gap: calc(var(--button-size-gap-default) * 0.5);
      min-width: calc(var(--button-size-min-medium) * 0.8);
      min-height: calc(var(--button-size-min-medium) * 0.8);
      padding: calc(var(--button-size-padding-small) * 0.5);
      font-size: calc(var(--button-text-size-medium) * 0.85);

      &.small,
      &.medium,
      &.large {
        min-width: calc(var(--button-size-min-small) * 0.8);
        min-height: calc(var(--button-size-min-small) * 0.8);
        padding: calc(
          var(--button-size-padding-small, var(--button-size-gap-small)) * 0.5
        );
        font-size: calc(var(--button-text-size-small) * 0.85);
      }
    }
  }
}

@keyframes button-spinner-rotate {
  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: reduce) {
  .button {
    transition: none;

    &:active {
      transform: none;
    }
  }

  .spinner {
    animation: none;
  }
}
