@use './Progress.tokens.generated.scss' as progressTokens;

.progress {
  @include progressTokens.vars;

  display: inline-flex;
  gap: var(--progress-spacing-gap);
  align-items: center;

  // Linear variant
  &.linear {
    width: 100%;

    .track {
      position: relative;
      overflow: hidden;
      width: 100%;
      background: var(--progress-color-track-background);
    }

    .fill {
      height: 100%;
      background: var(--progress-color-fill-info);
      border-radius: inherit;
      transition: width 0.3s ease-out;
    }

    .circleForeground {
      stroke: var(--progress-color-fill-info);
    }

    // Size variants for linear
    &.sm .track {
      height: var(--progress-size-linear-sm-height);
      border-radius: var(--progress-size-linear-sm-radius);
    }

    &.md .track {
      height: var(--progress-size-linear-md-height);
      border-radius: var(--progress-size-linear-md-radius);
    }

    &.lg .track {
      height: var(--progress-size-linear-lg-height);
      border-radius: var(--progress-size-linear-lg-radius);
    }

    // Indeterminate animation for linear
    &.indeterminate .fill {
      width: 30% !important;
      animation: progressIndeterminateLinear
        var(--progress-motion-duration-indeterminate)
        var(--progress-motion-easing-indeterminate) infinite;
    }
  }

  // Circular variant
  &.circular {
    position: relative;
    display: inline-flex;
    justify-content: center;
    align-items: center;

    .circle {
      transform: rotate(-90deg);
    }

    .circleBackground {
      stroke: var(--progress-color-track-background);
    }

    .circleForeground {
      transition: stroke-dashoffset 0.3s ease-out;
      stroke: var(--progress-color-fill-info);
    }

    // Size variants for circular
    &.sm {
      .circle {
        width: var(--progress-size-circular-sm-size);
        height: var(--progress-size-circular-sm-size);
      }

      .circleBackground,
      .circleForeground {
        stroke-width: var(--progress-size-circular-sm-strokeWidth);
      }
    }

    &.md {
      .circle {
        width: var(--progress-size-circular-md-size);
        height: var(--progress-size-circular-md-size);
      }

      .circleBackground,
      .circleForeground {
        stroke-width: var(--progress-size-circular-md-strokeWidth);
      }
    }

    &.lg {
      .circle {
        width: var(--progress-size-circular-lg-size);
        height: var(--progress-size-circular-lg-size);
      }

      .circleBackground,
      .circleForeground {
        stroke-width: var(--progress-size-circular-lg-strokeWidth);
      }
    }

    // Indeterminate animation for circular
    &.indeterminate .circleForeground {
      animation: progressIndeterminateCircular
        var(--progress-motion-duration-indeterminate) linear infinite;
      stroke-dasharray: 25 75;
    }
  }

  // Intent colors - declared after base variant styles to satisfy no-descending-specificity
  &.info {
    .fill,
    .circleForeground {
      background: var(--progress-color-fill-info);
      stroke: var(--progress-color-fill-info);
    }
  }

  &.success {
    .fill,
    .circleForeground {
      background: var(--progress-color-fill-success);
      stroke: var(--progress-color-fill-success);
    }
  }

  &.warning {
    .fill,
    .circleForeground {
      background: var(--progress-color-fill-warning);
      stroke: var(--progress-color-fill-warning);
    }
  }

  &.danger {
    .fill,
    .circleForeground {
      background: var(--progress-color-fill-danger);
      stroke: var(--progress-color-fill-danger);
    }
  }
}

.value {
  flex-shrink: 0;
  color: var(--progress-color-text-default);
  font-weight: var(--progress-typography-value-fontWeight);
  font-size: var(--progress-typography-value-fontSize);
  white-space: nowrap;
}

// Position value text inside circular progress
.progress.circular .value {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}

// Animations
@keyframes progressIndeterminateLinear {
  0% {
    transform: translateX(-100%);
  }

  100% {
    transform: translateX(400%);
  }
}

@keyframes progressIndeterminateCircular {
  0% {
    transform: rotate(0deg);
  }

  100% {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: reduce) {
  .progress {
    .fill,
    .circleForeground {
      transition: none;
    }

    &.indeterminate {
      .fill,
      .circleForeground {
        animation: none;
      }

      // Show static state for reduced motion
      .fill {
        width: 50% !important;
      }

      .circleForeground {
        transform: none;
        stroke-dasharray: 50 50;
      }
    }
  }
}
